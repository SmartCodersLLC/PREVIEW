(this["webpackJsonpavn-umk-frontend"]=this["webpackJsonpavn-umk-frontend"]||[]).push([[4],{108:function(e,t,n){},115:function(e,t,n){e.exports={darkBG:"Modal_darkBG__H2Rhy",centered:"Modal_centered__xRpse",modal:"Modal_modal__2aDnM",modalHeader:"Modal_modalHeader__1EQ-Q",heading:"Modal_heading__1NOny",modalContent:"Modal_modalContent__1K7Oo",closeBtn:"Modal_closeBtn__2sAmi"}},116:function(e,t,n){e.exports={loader:"Spinner_loader__21JSP",dot:"Spinner_dot__2Bh8A"}},132:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return ie}));var a=n(0),c=n(46),r=n(107),l=n(4),i=n(25),o=n(2),s=n(11),d=n.n(s),u=n(17),b=n(131),j=n(40),p=n(111),m=n(32),f=n(113),h=n(114),O="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8";var x=n(47),v=(new Date).getFullYear(),k=v%100-4,y=v%100-3,_=v%100-2,g=v%100-1,w=v%100,N=v%100+1,S="".concat(v-4,"-").concat(v-3),C="".concat(v-3,"-").concat(v-2),B="".concat(v-2,"-").concat(v-1),E="".concat(v-1,"-").concat(v),D="".concat(v,"-").concat(v+1),U=[{value:k,label:S},{value:y,label:C},{value:_,label:B},{value:g,label:E},{value:w,label:D},{value:N,label:"".concat(v+1,"-").concat(v+2)}],L=Object(u.b)({key:"yearListState",default:U}),M=(Object(u.b)({key:"defaultYearState",default:{value:w,label:D}}),Object(u.b)({key:"selectedYearState",default:{value:w,label:D}})),T={value:0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0430\u0444\u0435\u0434\u0440\u0443"},F=Object(u.b)({key:"kafedraListState",default:[T]}),I=(Object(u.b)({key:"defaultKafedraState",default:T}),Object(u.b)({key:"selectedKafedraState",default:T})),W=Object(u.b)({key:"umkListState",default:[]}),z=Object(u.b)({key:"selectedUmkState",default:null}),R=Object(u.b)({key:"umkDetailListState",default:[]}),A={value:0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0443\u0440\u0441"},H=Object(u.b)({key:"rateListState",default:[A].concat([{value:1,label:"selector.rate1"},{value:2,label:"selector.rate2"},{value:3,label:"selector.rate3"},{value:4,label:"selector.rate4"},{value:5,label:"selector.rate5"},{value:6,label:"selector.rate6"}])}),K=(Object(u.b)({key:"defaultRateState",default:A}),Object(u.b)({key:"selectedRateState",default:A})),P=n(13),G=function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.year,e.next=3,P.c.post("select/kafedra/list",{year:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.c.post("select/year/list",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.c.post("select/year/default",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q={kafedraList:G,yearList:J,yearDefault:Y},q=function(){var e=Object(i.a)(d.a.mark((function e(t){var n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.year,a=t.kafedra,c=t.rate,e.next=3,P.c.post("umk/list",{year:n,kafedra:a,rate:c});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=Object(i.a)(d.a.mark((function e(t){var n,a,c,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.rate,a=t.id_typeUmk,c=t.id_discipline,r=t.id_teacher,e.next=3,P.c.post("umk/detail",{rate:n,id_discipline:c,id_typeUmk:a,id_teacher:r});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X={list:q,detail:V},Z=n(8);function $(e){var t=e.children,n=e.index,a=e.rowSpaner;return 0==n?Object(Z.jsxs)("tr",{children:[a," ",t]}):Object(Z.jsx)("tr",{children:t})}var ee=n(115),te=n.n(ee),ne=function(e){var t=e.setIsOpen,n=e.title,c=e.children,r=e.isOpen,l=e.id;return Object(a.useEffect)((function(){return document.body.style.overflow=r?"hidden":"unset",function(){return document.body.style.overflow="unset"}}),[]),Object(a.useEffect)((function(){document.body.style.overflow=r?"hidden":"unset"}),[r]),r?Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)("div",{className:te.a.darkBG,onClick:function(){return t(!1)}}),Object(Z.jsx)("div",{className:te.a.centered,children:Object(Z.jsxs)("div",{className:te.a.modal,id:l,children:[Object(Z.jsx)("div",{className:te.a.modalHeader,children:Object(Z.jsx)("h5",{className:"".concat(te.a.heading," text-center"),children:n})}),Object(Z.jsx)("button",{className:"".concat(te.a.closeBtn," no-print"),onClick:function(){return t(!1)},children:Object(Z.jsx)("i",{className:"fas fa-close"})}),Object(Z.jsx)("div",{className:te.a.modalContent,children:c})]})})]}):null},ae=n(116),ce=n.n(ae),re=function(e){var t=e.size||"16px",n=e.size||"16px",a=e.color||"#888";return Object(Z.jsxs)("div",{className:ce.a.loader,children:[Object(Z.jsx)("div",{className:ce.a.dot,style:{width:t,height:n,backgroundColor:a}}),Object(Z.jsx)("div",{className:ce.a.dot,style:{width:t,height:n,backgroundColor:a}}),Object(Z.jsx)("div",{className:ce.a.dot,style:{width:t,height:n,backgroundColor:a}})]})};n(108);function le(){var e=Object(r.a)().t,t=Object(u.c)(x.a),n=Object(o.a)(t,2),c=(n[0],n[1],Object(u.c)(L)),s=Object(o.a)(c,2),v=s[0],k=(s[1],Object(u.c)(M)),y=Object(o.a)(k,2),_=y[0],g=y[1],w=Object(u.c)(F),N=Object(o.a)(w,2),S=N[0],C=N[1],B=Object(u.e)(F),E=Object(u.c)(I),D=Object(o.a)(E,2),U=D[0],T=D[1],A=Object(u.e)(I),G=Object(u.c)(W),J=Object(o.a)(G,2),Y=J[0],q=J[1],V=Object(u.e)(W),ee=Object(u.c)(R),te=Object(o.a)(ee,2),ae=te[0],ce=te[1],le=Object(u.e)(R),ie=Object(u.c)(z),oe=Object(o.a)(ie,2),se=oe[0],de=oe[1],ue=(Object(u.e)(z),Object(u.c)(H)),be=Object(o.a)(ue,2),je=be[0],pe=(be[1],Object(u.c)(K)),me=Object(o.a)(pe,2),fe=me[0],he=me[1],Oe=Object(u.e)(K),xe=Object(a.useState)([]),ve=Object(o.a)(xe,2),ke=ve[0],ye=ve[1],_e=Object(a.useState)(null),ge=Object(o.a)(_e,2),we=ge[0],Ne=ge[1],Se={discipline:0,teacher:"0/0"},Ce=Object(a.useState)(Se),Be=Object(o.a)(Ce,2),Ee=Be[0],De=Be[1],Ue=Object(a.useState)(!1),Le=Object(o.a)(Ue,2),Me=Le[0],Te=Le[1],Fe=function(){return De(Se)},Ie=function(){return ye([])},We=function(){var t=Object(i.a)(d.a.mark((function t(){var n,a,c,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Ne(e("umk:report.load.kafedra")),console.time("kafedra"),t.next=4,Q.kafedraList({year:_.value});case 4:if(n=t.sent,a=n.data,c=n.message,n.error&&Object(m.a)(c,"error"),0!==a.length){t.next=13;break}return Object(m.a)(e("selector.noKafedra"),"error"),Ne(null),t.abrupt("return");case 13:r=a.map((function(e){return{value:e.id_kafedra,label:e.name}})),C(r),Ne(null),console.timeEnd("kafedra");case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ze=function(){var t=Object(i.a)(d.a.mark((function t(){var n,a,c,r,i,o,s,u,b,j;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(S.length<2||0===U.value||0===fe.value)){t.next=2;break}return t.abrupt("return");case 2:return console.time("getUmkList"),Ne(e("umk:report.load.umk")),t.next=6,X.list({year:_.value,kafedra:U.value,rate:fe.value});case 6:if(n=t.sent,a=n.data,c=n.message,r=n.error,Ne(null),console.timeEnd("getUmkList"),!r){t.next=17;break}return Object(m.a)(c,"error"),q([]),ye([]),t.abrupt("return");case 17:if(0!==(null===a||void 0===a?void 0:a.length)){t.next=22;break}return Object(m.a)(e("umk:report.noData"),"error"),q([]),ye([]),t.abrupt("return");case 22:Ne(e("umk:report.load.render")),console.time("render"),i=Object(p.sortBy)(a,["p34","s_t_fio"],["asc","asc"]),o=Object(p.chain)(i).groupBy((function(e){return e.p34})).map((function(e,t){return{discipline_name:t,disciplines:Object(p.chain)(e).groupBy((function(e){return e.s_t_fio})).map((function(e,t){return{teacher_name:t,teacher_id:e[0].id_teacher,types:Object(p.chain)(e).groupBy((function(e){return e.umkName})).map((function(e,t){return{umk_name:t,kol:Object(p.sumBy)(e,"kol"),umks:e}})).value()}})).value()}})).value(),q(o),s=Object(p.uniqBy)(a,(function(e){return e.umkName})).sort((function(e,t){return e.sort>t.sort})).map((function(e){return e.umkName})),u={},s.forEach((function(e){var t=a.filter((function(t){return t.umkName===e})).reduce((function(e,t){return-1==t.id_teacher?e+1:(u.all=u.all?u.all+t.kol:t.kol,e+t.kol)}),0);u[e]=t})),ye(s),b=o.map((function(e){return e.disciplines.map((function(e){return e.teacher_id}))})).flat().filter((function(e){return e>0})),j=new Set(b),De(Object(l.a)({discipline:o.length,teacher:"".concat(j.size," / ").concat(b.length)},u)),Ne(null),console.timeEnd("render");case 36:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Re=function(){var t=Object(i.a)(d.a.mark((function t(n){var a,c,r,l,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.time("getUmkDetails"),Ne(e("umk:report.load.details")),t.next=4,X.detail({rate:fe.value,id_discipline:n.id_discipline,id_typeUmk:n.id_typeUmk,id_teacher:n.id_teacher});case 4:if(a=t.sent,c=a.data,r=a.status,l=a.message,i=a.error,Ne(null),console.timeEnd("getUmkDetails"),!i){t.next=15;break}return Object(m.a)(l,"error"),ce([]),t.abrupt("return");case 15:if(404!==r){t.next=19;break}return Object(m.a)(e("umk:report.noData"),"error"),ce([]),t.abrupt("return");case 19:ce(c);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ae=["csv","xlsx","jpg","jpeg","gif","gif","png","pdf","docx","mp3","webm","mp4","wexbim"],He=function(e){return e.split(".").pop()},Ke=function(){U.value&&fe.value&&_.value?window.print():Object(m.a)(e("umk:report.noData"),"error")},Pe=function(){if(se){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Printer",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=document.getElementById("printWindow");a&&document.body.removeChild(a);var c=document.createElement("iframe");c.style.position="absolute",c.style.top="-1000px",c.style.left="-1000px",c.id="printWindow";var r="<html><head><title>".concat(t,"</title></head><body><style>").concat(n,"</style>").concat(e,"</body></html>");document.body.appendChild(c),c.contentWindow.document.open(),c.contentWindow.document.write(r),c.contentWindow.document.close(),c.contentWindow.print()}(document.getElementById("modalDetail").innerHTML,e("head.umk"),"h5 {text-align: center; margin: 0; margin-bottom: 20px; font-size: 18px;}\n      table { border-collapse: collapse; background-color: #fff; width: 100%; font-size: 14px;}\n      td.break { float: left; line-height: 22px;}\n      td, th { padding: 5px 10px; height: 35px; border: 1px solid #606060 !important;}\n      table thead tr, table tbody td, small { color: black !important; }\n      .no-print, .no-print-child, .no-print-child * { display: none !important; }\n      p { margin: 0; padding: 5px; }\n      .text-center { text-align: center;}\n      .text-left { text-align: left;}\n      .text-right { text-align: right;}")}else Object(m.a)(e("umk:report.noData"),"error")},Ge=function(e,t){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"export_table",n=document.getElementById(e),a=h.a.table_to_book(n),c=h.b(a,{bookType:"xlsx",type:"array"}),r=new Blob([c],{type:O});f.saveAs(r,t+".xlsx")}(e,t)};return Object(a.useEffect)((function(){A(),B(),Oe(),V(),Fe(),Ie(),We()}),[_]),Object(a.useEffect)((function(){V(),Oe(),Fe(),Ie()}),[U]),Object(a.useEffect)((function(){V(),Fe(),Ie(),ze()}),[fe]),Object(Z.jsxs)("div",{className:"UMKContainer",children:[Object(Z.jsxs)("div",{className:"Selectors_Wrapper no-print",children:[Object(Z.jsx)(j.b,{to:"/avnumk/",children:Object(Z.jsx)("button",{title:e("back"),children:Object(Z.jsx)("i",{className:"fas fa-arrow-left"})})}),Object(Z.jsx)(b.a,{className:"Select",classNamePrefix:"my_select",value:_,isSearchable:!1,placeholder:e("selector.choose"),onChange:function(e){g(e)},options:null===v||void 0===v?void 0:v.map((function(e){return e}))}),Object(Z.jsx)(b.a,{className:"Select",classNamePrefix:"my_select",value:U,isSearchable:!0,placeholder:e("cm:selector.choose"),onChange:function(e){T(e)},options:null===S||void 0===S?void 0:S.map((function(t){return{value:t.value,label:e(t.label)}}))}),Object(Z.jsx)(b.a,{className:"Select",classNamePrefix:"my_select",value:fe,isSearchable:!1,placeholder:e("cm:selector.choose"),onChange:function(t){0===U.value&&S.length>1?Object(m.a)(e("selector.chooseDeparment"),"error"):he(t)},options:null===je||void 0===je?void 0:je.map((function(t){return{value:t.value,label:e(t.label)}}))}),Object(Z.jsx)("div",{children:we?Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)(re,{size:"15px",color:"blue"}),we]}):null}),Object(Z.jsx)("div",{className:"flex",children:(null===Y||void 0===Y?void 0:Y.length)>0&&!Me?Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)("button",{className:"Button",title:e("export"),onClick:function(){Ge("listTable","\u0423\u041c\u041a_".concat(null===_||void 0===_?void 0:_.label,"_").concat(U.label,"_").concat(fe.label))},children:Object(Z.jsx)("i",{className:"fa fa-file-export"})}),Object(Z.jsx)("button",{className:"Button",title:e("print"),onClick:function(){Ke()},children:Object(Z.jsx)("i",{className:"fas fa-print"})})]}):null})]}),Object(Z.jsx)(ne,{title:null===se||void 0===se?void 0:se.umkName,isOpen:Me,setIsOpen:function(e){Te(e)},id:"modalDetail",children:Object(Z.jsxs)("div",{children:[Object(Z.jsxs)("div",{className:"text-left",children:[Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.kafedra"),": ",U.label]})}),Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.rate"),": ",null===se||void 0===se?void 0:se.rate]})}),Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.discipline"),": ",null===se||void 0===se?void 0:se.p34]})}),Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.teacher"),": ",null===se||void 0===se?void 0:se.s_t_fio]})}),Object(Z.jsx)("br",{}),Object(Z.jsx)("div",{className:"no-print flex",children:(null===ae||void 0===ae?void 0:ae.length)>0&&Me?Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)("button",{className:"Button",title:e("export"),onClick:function(){Ge("detailTable","\u0423\u041c\u041a_".concat(null===se||void 0===se?void 0:se.umkName,"_").concat(U.label,"_").concat(fe.label,"_").concat(null===se||void 0===se?void 0:se.p34,"_").concat(null===se||void 0===se?void 0:se.s_t_fio))},children:Object(Z.jsx)("i",{className:"fa fa-file-export"})}),Object(Z.jsx)("button",{className:"Button",title:e("print"),onClick:function(){Pe()},children:Object(Z.jsx)("i",{className:"fas fa-print"})})]}):null})]}),ae.length>0?Object(Z.jsx)(Z.Fragment,{children:Object(Z.jsxs)("table",{id:"detailTable",children:[Object(Z.jsx)("thead",{children:Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("th",{width:"5%",children:"\u2116"}),Object(Z.jsx)("th",{children:e("umk:report.table.name")}),Object(Z.jsx)("th",{children:e("umk:report.table.description")}),Object(Z.jsx)("th",{children:e("umk:report.table.semester")}),Object(Z.jsx)("th",{children:e("umk:report.table.file")}),Object(Z.jsx)("th",{className:"no-print",children:e("umk:report.table.download")}),Object(Z.jsx)("th",{className:"no-print",children:e("umk:report.table.view")})]})}),Object(Z.jsx)("tbody",{children:ae.map((function(t,n){return Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:n+1}),Object(Z.jsx)("td",{children:t.name}),Object(Z.jsx)("td",{children:t.description}),Object(Z.jsx)("td",{children:t.p43}),Object(Z.jsx)("td",{children:t.fileName}),Object(Z.jsx)("td",{className:"no-print",children:Object(Z.jsx)("span",{className:"pointer",title:e("umk:report.table.downloadTitle"),onClick:function(){return function(e){var t=e.id,n=e.name,a="".concat(t,"_").concat(encodeURIComponent(n)),c="".concat(P.b,"/umk/download?file=").concat(a);window.open(c,"_blank")}({id:t.id,name:t.fileName})},children:Object(Z.jsx)("i",{className:"fas fa-download"})})}),Object(Z.jsx)("td",{className:"no-print",children:(a=He(t.fileName),Ae.includes(a)?Object(Z.jsxs)("span",{className:"pointer",title:e("umk:report.table.viewTitle"),onClick:function(){return function(e){var t=e.id,n=e.name,a="".concat(t,"_").concat(encodeURIComponent(n)),c=He(a),r="/avnumk/view?file=".concat(a,"&type=").concat(c);window.open(r,"_blank")}({id:t.id,name:t.fileName})},children:[" ",Object(Z.jsx)("i",{className:"fas fa-eye"})]}):null)})]},t.id);var a}))})]})}):null]})}),Object(Z.jsxs)("div",{className:"A4",id:"A4",children:[Object(Z.jsxs)("div",{className:"text-left",children:[Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.year"),": ",_.label]})}),Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.kafedra"),": ",U.label]})}),Object(Z.jsx)("p",{children:Object(Z.jsxs)("small",{children:[e("umk:report.rate"),": ",fe.label]})}),Object(Z.jsx)("br",{})]}),Object(Z.jsxs)("table",{id:"listTable",children:[Object(Z.jsx)("thead",{children:Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("th",{width:"5%",children:e("umk:report.discipline")}),Object(Z.jsx)("th",{children:e("umk:report.teacher")}),ke.map((function(e){return Object(Z.jsx)("th",{children:e},e)}))]})}),Object(Z.jsxs)("tbody",{children:[null===Y||void 0===Y?void 0:Y.map((function(e,t){return e.disciplines.map((function(t,n){return Object(Z.jsxs)($,{index:n,rowSpaner:Object(Z.jsx)("td",{rowSpan:e.disciplines.length,children:e.discipline_name}),children:[Object(Z.jsx)("td",{children:t.teacher_name}),ke.map((function(e,n){var a=t.types.filter((function(t){return t.umk_name==e}))[0];return null!==a&&void 0!==a&&a.umks.length?Object(Z.jsx)("td",{children:Object(Z.jsx)("div",{className:"umkCount",onClick:function(){return function(e){le(),Te(!0),de(e),Re(e)}(null===a||void 0===a?void 0:a.umks[0])},children:null===a||void 0===a?void 0:a.kol})},n+""+(null===a||void 0===a?void 0:a.umk_name)):Object(Z.jsx)("td",{children:"-"})}))]})}))})),Ee.all&&Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsxs)("tr",{children:[Object(Z.jsxs)("td",{children:[Object(Z.jsxs)("b",{children:[e("umk:report.summary.disciplines"),":"]})," ",null===Ee||void 0===Ee?void 0:Ee.discipline]}),Object(Z.jsxs)("td",{children:[e("umk:report.summary.teachers")," ",Object(Z.jsx)("br",{})," ",null===Ee||void 0===Ee?void 0:Ee.teacher]}),ke.map((function(e){return Object(Z.jsxs)("td",{children:[e," ",Object(Z.jsx)("br",{}),Ee[e]]},e)}))]}),Object(Z.jsx)("tr",{children:Object(Z.jsxs)("td",{colSpan:2+(null===ke||void 0===ke?void 0:ke.length),children:[e("umk:report.summary.all"),": ",null===Ee||void 0===Ee?void 0:Ee.all]})})]})]})]})]})]})}function ie(){var e=Object(r.a)().t;return Object(Z.jsxs)("div",{className:"Main",children:[Object(Z.jsxs)(c.a,{children:[Object(Z.jsx)("meta",{charSet:"utf-8"}),Object(Z.jsxs)("title",{children:[e("head.umk")," | ",e("head.appTitle")]})]}),Object(Z.jsx)(le,{})]})}}}]);
//# sourceMappingURL=4.c5e5744d.chunk.js.map